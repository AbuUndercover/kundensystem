{% extends "base.html" %}
{% block inhalt %}
<h2>Auftragsverwaltung</h2>

<!-- Filterbereich -->
<form method="GET" action="{{ url_for('auftraege') }}" style="margin-bottom: 10px;">
  <fieldset style="border:1px solid #ccc; padding:10px;">
    <legend>Filter</legend>
    <label>Status:</label>
    <select name="status" style="width:150px;">
      <option value="" {% if not status_q %}selected{% endif %}>(alle)</option>
      <option value="offen" {% if status_q=='offen' %}selected{% endif %}>offen</option>
      <option value="erledigt" {% if status_q=='erledigt' %}selected{% endif %}>erledigt</option>
    </select>
    <button type="submit" style="margin-left:10px;">Anwenden</button>
    <a href="{{ url_for('auftraege') }}" style="margin-left:10px;">Filter zurÃ¼cksetzen</a>
  </fieldset>
</form>

{% if erfolg %}
<div class="info-box info-erfolg">
  âœ… {{ erfolg }}
</div>
{% endif %}

{% if meldungen %}
<div class="info-box info-fehler">
  <ul>
    {% for m in meldungen %}
      <li>{{ m }}</li>
    {% endfor %}
  </ul>
</div>
{% endif %}

<!-- Formular: neuen Auftrag anlegen -->
<form method="POST" action="{{ url_for('auftraege') }}">
  <label>Kunde:</label><br>
  <select name="kunde_id">
    {% for k in kunden %}
      <option value="{{ k.id }}">{{ k.name }}</option>
    {% endfor %}
  </select><br><br>

  <label>Beschreibung:</label><br>
  <input type="text" name="beschreibung"><br><br>

  <label>Betrag (â‚¬):</label><br>
  <input type="text" name="betrag"><br><br>

  <label>Datum (YYYY-MM-DD):</label><br>
  <input type="text" name="datum"><br><br>

  <label>Status:</label><br>
  <select name="status">
    <option value="offen">offen</option>
    <option value="erledigt">erledigt</option>
  </select><br><br>

  <button type="submit">Auftrag speichern</button>
</form>

<hr>

<h3>Gespeicherte AuftrÃ¤ge</h3>
<table border="1" cellpadding="5" cellspacing="0">
  <tr style="background-color:#ddd;">
    <th>ID</th>
    <th>Kunde</th>
    <th>Beschreibung</th>
    <th>Betrag</th>
    <th>Datum</th>
    <th>Status</th>
    <th>Aktionen</th>
  </tr>
  {% for a in auftraege %}
  <tr>
    <td>{{ a.id }}</td>
    <td>{{ a.kunde }}</td>
    <td>{{ a.beschreibung }}</td>
    <td>{{ a.betrag }} â‚¬</td>
    <td>{{ a.datum }}</td>
    <td>{{ a.status }}</td>
    <td>
      <a href="{{ url_for('auftrag_bearbeiten', auftrag_id=a.id) }}">âœï¸ Bearbeiten</a> |
      <a href="{{ url_for('auftrag_loeschen_route', auftrag_id=a.id) }}"
         onclick="return confirm('Diesen Auftrag wirklich lÃ¶schen?')">ğŸ—‘ï¸ LÃ¶schen</a>
    </td>
  </tr>
  {% endfor %}
</table>
{% endblock %}
